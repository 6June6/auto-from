# 报名工具提交数据结构说明

根据前端 Vue.js 代码 (app.formatted.js) 分析，报名工具的表单提交数据结构如下：

## 字段类型定义

```python
FIELD_TYPE_TEXT = 0       # 单行文本
FIELD_TYPE_NUMBER = 1     # 数字
FIELD_TYPE_TEXTAREA = 2   # 多行文本
FIELD_TYPE_DATE = 3       # 日期
FIELD_TYPE_RADIO = 4      # 单选 ⚠️ 注意：不是2
FIELD_TYPE_CHECKBOX = 5   # 多选 ⚠️ 注意：不是之前的定义
FIELD_TYPE_IMAGE = 6      # 图片上传
FIELD_TYPE_FILE = 7       # 文件上传
FIELD_TYPE_ADDRESS = 8    # 地址
FIELD_TYPE_ID_CARD = 9    # 身份证
FIELD_TYPE_SELECT = 10    # 下拉选择
FIELD_TYPE_REGION = 12    # 地区选择
FIELD_TYPE_PHONE = 13     # 手机号 ⚠️ 新增
FIELD_TYPE_RICH_TEXT = 14 # 富文本/图片上传 ⚠️ 新增
```

## 提交数据结构

### 1. 单选字段 (field_type = 4)

```json
{
  "field_key": "xxx",
  "field_name": "性别",
  "ignore": 0,
  "field_value": "0dc07",           // 选项的 key（不是 value）
  "new_field_value": "自定义值"      // "其他"选项的自定义输入值
}
```

**关键点：**
- `field_value` 是选项的 `key`，不是 `value`
- 需要包含 `new_field_value` 字段（即使为空字符串）
- "其他"选项的自定义值通过 `new_field_value` 传递

### 2. 多选字段 (field_type = 5)

```json
{
  "field_key": "xxx",
  "field_name": "兴趣爱好",
  "ignore": 0,
  "field_value": ["key1", "key2", "key3"],        // 数组！选项的 key
  "new_field_value": ["自定义1", "自定义2"]        // 数组！"其他"选项的自定义值
}
```

**关键点：**
- ⚠️ `field_value` 必须是**数组**，不能是逗号分隔的字符串
- ⚠️ `new_field_value` 也必须是**数组**
- 数组元素是选项的 `key`，不是 `value`
- 前端会自动去重：`[...new Set(field_value)]`

### 3. 图片上传字段 (field_type = 6)

```json
{
  "field_key": "xxx",
  "field_name": "头像",
  "ignore": 0,
  "field_value": "https://oss.fang-qingsong.com/test/xxx/xxx.jpg"
}
```

**关键点：**
- `field_value` 是上传后的 OSS URL（字符串）
- **不需要** `new_field_value` 字段
- 必须先上传图片到 OSS，获取 URL 后再提交

### 4. 其他字段类型 (0,1,2,3,7,8,9,10,12)

```json
{
  "field_key": "xxx",
  "field_name": "姓名",
  "ignore": 0,
  "field_value": "张三"  // 字符串
}
```

**关键点：**
- 只有 `field_value` 字段（字符串）
- 不需要 `new_field_value`

## 前端代码参考 (app.formatted.js 第 69738-69770 行)

```javascript
const a = this.filteredFields.map((l) => {
  const e = {
    field_key: l.field_key,
    field_name: l.field_name,
    ignore: l.ignore || 0,
  };
  switch (l.field_type) {
    case 4:  // 单选
      return {
        ...e,
        field_value: this.formData[l.field_key].field_value,
        new_field_value: this.formData[l.field_key].new_field_value,
      };
    case 5:  // 多选
      return {
        ...e,
        field_value: [...new Set(this.formData[l.field_key].field_value)],  // 数组去重
        new_field_value: [...new Set(this.formData[l.field_key].new_field_value)],
      };
    default:  // 其他类型（包括图片上传）
      return {
        ...e,
        field_value: this.formData[l.field_key].field_value,
      };
  }
});
```

## 常见错误

### ❌ 错误 1：多选字段使用逗号分隔的字符串
```python
# 错误
{
  "field_value": "key1,key2,key3"  # 字符串
}

# 正确
{
  "field_value": ["key1", "key2", "key3"]  # 数组
}
```

### ❌ 错误 2：单选/多选字段缺少 new_field_value
```python
# 错误（单选）
{
  "field_value": "key1"
  # 缺少 new_field_value
}

# 正确
{
  "field_value": "key1",
  "new_field_value": ""  # 即使为空也要有
}
```

### ❌ 错误 3：使用选项的 value 而不是 key
```python
# 错误
{
  "field_value": "男"  # 这是 value
}

# 正确
{
  "field_value": "0dc07"  # 这是 key
}
```

## OSS 图片上传配置

```python
ACCESS_KEY_ID = "LTAI5tHzG8jWeAZG2mP2MFvS"
POLICY = "eyJleHBpcmF0aW9uIjoiMjEwMC0wMS0wMVQxMjowMDowMC4wMDBaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF1dfQ=="
SIGNATURE = "jdjUfw+5vYWYkzjyiQYXveiP1nA="
UPLOAD_URL = "https://taiguoossanmo.oss-accelerate.aliyuncs.com"
HOST = "https://oss.fang-qingsong.com"
DIRNAME = "test"
```

上传成功后，返回的 URL 格式：
```
https://oss.fang-qingsong.com/test/{user_id}/{timestamp}_{uuid}.jpg
```

## API 接口

### 1. 新增报名
```
POST /xcx/enroll/v5/enroll
```

### 2. 更新报名
```
POST /xcx/enroll/v1/user_update
```

两个接口的 `info` 字段格式相同，都是上述的数组结构。
