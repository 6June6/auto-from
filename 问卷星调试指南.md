# 问卷星表单填充调试指南

## 当前问题

问卷星表单只检测到 1 个字段："我已阅读并同意问卷星"（同意条款），实际的表单输入字段未被识别。

## 已添加的调试功能

### 1. 页面结构分析

当填充问卷星表单时，JavaScript 脚本会自动输出以下调试信息：

```
🔍 [问卷星] 页面结构分析:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
页面URL: https://v.wjx.cn/vm/PcfX2M5.aspx
页面标题: 某知名护肤品小红书报备直发招募
Body内容长度: XXXXX 字符

📊 元素统计:
  - input 元素: X 个
  - textarea 元素: X 个
  - 问题容器 (div.question): X 个
  - 问卷星输入框 (.jqInput等): X 个
  - form 表单: X 个

📝 Input 类型分布:
  - text: X 个
  - checkbox: X 个
  - checkbox(隐藏): X 个
  - radio: X 个
  ...

⚠️ 发现 X 个 iframe，表单内容可能在 iframe 中
  iframe[0]: src="...", display="..."

📋 前5个问题容器内容:
  [1] 1. 小红书昵称...
  [2] 2. 小红书id...
  ...
```

### 2. 详细的等待日志

```
🔍 尝试 1/20: 找到 X 个输入框，其中 Y 个有效
⏭️  跳过同意条款字段: "我已阅读并同意..."
✅ 成功找到 Y 个有效输入框
```

## 测试步骤

1. **运行程序**
   ```bash
   cd /Users/chenchen/Desktop/开发项目/auto-form-filler-py
   python main.py
   ```

2. **打开问卷星表单**
   - 链接：`https://v.wjx.cn/vm/PcfX2M5.aspx`
   - 使用名片："111"

3. **查看调试日志**
   - 查看终端输出
   - 关注 `[问卷星] 页面结构分析` 部分
   - 查看 JavaScript 控制台（如果可以）

4. **关键检查点**
   
   **A. 检查页面是否完全加载**
   - Body内容长度应该 > 10000 字符
   - input 元素应该 > 5 个
   - 问题容器应该 > 0 个

   **B. 检查是否有 iframe**
   - 如果发现 iframe，表单内容可能在 iframe 内部
   - 需要切换到 iframe 中查找输入框

   **C. 检查输入框类型**
   - 查看 checkbox(隐藏) 的数量
   - 大量隐藏的 checkbox 说明是选择题
   - 需要特殊处理

   **D. 检查问题容器**
   - 如果有问题容器但没有 input，说明使用了自定义控件
   - 需要点击或其他方式激活输入框

## 可能的问题和解决方案

### 问题 1: 页面未完全加载

**症状**：
- Body内容长度很小（< 5000）
- input 元素数量为 0 或很少
- 问题容器数量为 0

**解决方案**：
- 增加等待时间
- 检查网络连接
- 尝试手动刷新页面

### 问题 2: 表单在 iframe 中

**症状**：
- 调试信息显示："发现 X 个 iframe"
- 主页面没有 input，但有 iframe

**解决方案**：
- 需要修改 JavaScript 代码，切换到 iframe 内部
- 使用 `iframe.contentDocument` 访问内容

### 问题 3: 使用了自定义输入控件

**症状**：
- 有问题容器（div.question）
- 但没有对应的 input 元素
- 或者 input 都是隐藏的

**解决方案**：
- 查看问题容器的 HTML 结构
- 可能需要点击容器才能激活输入框
- 或者使用 div[contenteditable] 等特殊元素

### 问题 4: 表单需要滚动加载（懒加载）

**症状**：
- 只能看到前几个问题
- 滚动后才出现更多输入框

**解决方案**：
- 添加滚动逻辑
- 等待所有内容加载完成

## 下一步行动

根据调试信息的输出，我们可以：

1. **如果是 iframe 问题**
   - 修改代码以支持 iframe 内的表单

2. **如果是自定义控件**
   - 分析控件的 HTML 结构
   - 实现专门的填充逻辑

3. **如果是加载问题**
   - 增加等待时间
   - 添加滚动逻辑

4. **如果是权限问题**
   - 检查是否需要登录
   - 检查是否有防爬虫机制

## 查看日志的位置

1. **终端输出**
   - 主要的调试信息会输出到终端
   - 查找 `[问卷星]` 标记

2. **日志文件**
   - 可能保存在 `error.log` 或其他日志文件中

3. **浏览器控制台**（如果可以访问）
   - 打开开发者工具
   - 查看 Console 标签

## 联系开发者

如果问题持续存在，请提供：
1. 完整的调试日志（`[问卷星] 页面结构分析` 部分）
2. 截图（显示表单的实际样子）
3. 浏览器控制台的输出（如果可以访问）

