# 🚀 自动表单填写工具 (Python 桌面版)

<div align="center">

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![PyQt6](https://img.shields.io/badge/PyQt6-6.6.1-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**智能识别表单字段，一键自动填写，提升效率 10 倍！**

[快速开始](#-快速开始) • [功能特点](#-功能特点) • [使用说明](#-使用说明) • [截图](#-截图预览)

</div>

---

## 📖 项目简介

这是一个基于 **Python + PyQt6 + WebEngine** 开发的桌面应用，可以智能识别网页表单字段并自动填写。相比浏览器插件，桌面应用更加稳定可靠，无需安装任何浏览器扩展。

### 为什么选择桌面版？

✅ **更强大**：内嵌浏览器，完全控制网页行为  
✅ **更安全**：数据本地存储，不上传任何信息  
✅ **跨平台**：支持 Windows、macOS、Linux  
✅ **易管理**：可视化界面管理名片和链接  
✅ **零限制**：不受浏览器策略限制

## ✨ 功能特点

### 核心功能

| 功能          | 描述                     | 状态      |
| ------------- | ------------------------ | --------- |
| 🎯 智能匹配   | 模糊匹配表单字段名称     | ✅ 已实现 |
| 📇 名片管理   | 创建、编辑、删除填写配置 | ✅ 已实现 |
| 🔗 链接管理   | 管理常用表单链接         | ✅ 已实现 |
| 🌐 内嵌浏览器 | PyQt WebEngine 加载网页  | ✅ 已实现 |
| 📊 填写记录   | 记录每次填写结果         | ✅ 已实现 |
| 🔐 JWT 认证   | Token 自动登录、设备管理 | ✅ 已实现 |
| 📱 设备限制   | 每用户最多 2 台设备      | ✅ 已实现 |
| 👥 用户管理   | 多用户、角色权限管理     | ✅ 已实现 |
| 🎨 现代 UI    | 美观的界面设计           | ✅ 已实现 |
| 💾 MongoDB    | 云数据库存储             | ✅ 已实现 |

### 支持的表单平台

- ✅ **腾讯文档表单** (docs.qq.com/form) - 🆕 新增！
- ✅ **麦客 CRM 表单** (mikecrm.com)
- ✅ **通用 HTML 表单**

> 💡 应用会自动检测表单类型并使用对应的填写引擎！

### 支持的表单控件

- ✅ 文本输入框 (input type="text")
- ✅ 文本域 (textarea)
- ✅ 电话输入框 (input type="tel")
- ✅ 邮箱输入框 (input type="email")
- ✅ 数字输入框 (input type="number")
- ✅ 下拉框 (select)
- 🚧 单选框 (radio) - 待优化
- 🚧 复选框 (checkbox) - 待优化

## 🚀 快速开始

### 环境要求

- Python 3.10 或更高版本
- pip (Python 包管理器)

### 安装步骤

#### 1. 克隆或下载项目

```bash
cd ~/Desktop/开发项目
cd auto-form-filler-py
```

#### 2. 创建虚拟环境（推荐）

**macOS/Linux:**

```bash
python3 -m venv venv
source venv/bin/activate
```

**Windows:**

```bash
python -m venv venv
venv\Scripts\activate
```

#### 3. 安装依赖

```bash
pip install -r requirements.txt
```

#### 4. 运行程序

```bash
python main.py
```

## 📚 使用说明

### 第一次启动

程序会自动：

1. 创建 SQLite 数据库
2. 生成默认测试数据
   - 名片 1（包含 11 个配置项）
   - 测试链接（抖音招募表单）

### 基本使用流程

#### 步骤 1：管理名片

1. 点击主界面的 "📇 名片管理"
2. 点击 "➕ 新增名片"
3. 填写名片名称和描述
4. 添加配置项（字段名 → 填写值）
5. 保存

**示例配置：**

```
字段名: 平台    → 填写值: 抖音
字段名: 账号    → 填写值: 小明
字段名: 粉丝    → 填写值: 10000
字段名: 微信    → 填写值: weixin123
字段名: 电话    → 填写值: 13800138000
```

#### 步骤 2：管理链接

1. 点击主界面的 "🔗 链接管理"
2. 点击 "➕ 新增链接"
3. 填写链接名称和 URL
4. 选择状态和分类
5. 保存

#### 步骤 3：自动填写

1. 点击主界面的 "📝 自动填写"
2. 在左侧选择一张名片
3. 在左侧选择一个链接
4. 点击 "🚀 开始自动填写"
5. 等待页面加载和自动填写完成
6. 查看填写结果

#### 🆕 腾讯文档表单支持

现在可以直接填写腾讯文档表单！使用方法：

1. **添加腾讯文档表单链接**

   ```
   https://docs.qq.com/form/page/DV0JwTG9BTmJIZWNr
   ```

2. **配置名片字段**（字段名要与表单问题标题匹配）

   ```
   手机号【着急时联系】 → 13800138000
   微信 → weixin123
   抖音昵称 → 测试账号
   抖音账号 → test123456
   粉丝数量 → 10000
   主页链接 → https://example.com/profile
   赞藏量 → 5000
   所在地 → 北京
   （自行报价） → 300
   账号类型 → 母婴
   ```

3. **自动检测**

   - 应用会自动识别腾讯文档表单
   - 使用专门的填写引擎进行填写
   - 显示详细的填写结果

4. **使用诊断功能**
   - 点击 "🔍 诊断页面" 查看表单结构
   - 查看所有问题的标题和类型
   - 根据诊断结果调整名片配置

📚 详细文档：查看 [TENCENT_DOCS_SUPPORT.md](TENCENT_DOCS_SUPPORT.md)

### 高级功能

#### 查看配置面板

在自动填写页面点击 "📋 配置面板" 可以：

- 查看当前名片的所有配置项
- 实时参考配置进行手动填写（如果自动填写失败）

#### 填写记录

主界面底部显示最近 20 条填写记录：

- 填写时间
- 使用的名片和链接
- 成功填写的字段数
- 填写状态（成功/失败）

## 📸 截图预览

### 主界面

```
┌─────────────────────────────────────────┐
│     🚀 自动表单填写工具                  │
├─────────────────────────────────────────┤
│  📇 4    🔗 3    📊 12    ✅ 10         │
│ 名片总数  链接总数  填写记录  成功次数  │
├─────────────────────────────────────────┤
│  📝 自动填写  📇 名片管理  🔗 链接管理  │
├─────────────────────────────────────────┤
│          📊 最近填写记录                 │
│  时间    名片    链接    状态            │
│  ...                                     │
└─────────────────────────────────────────┘
```

### 名片管理

```
┌─────────────────────────────────────────┐
│  📇 名片管理            ➕ 新增名片      │
├─────────────────────────────────────────┤
│  名称   配置项数  创建时间    操作      │
│  名片1    11项   2025-10-09  [查看][编辑][删除] │
│  名片2     8项   2025-10-09  [查看][编辑][删除] │
└─────────────────────────────────────────┘
```

### 自动填写界面

```
┌──────────┬───────────────────────────────┐
│ 📇 选择名片│                                │
│  □ 名片1  │      🌐 网页显示区域           │
│  □ 名片2  │                                │
│          │      [自动填写的表单]           │
│ 🔗 选择链接│                                │
│  □ 链接1  │                                │
│  □ 链接2  │                                │
│          │                                │
│ [🚀 开始] │                                │
└──────────┴───────────────────────────────┘
```

## 🔧 技术架构

### 技术栈

- **GUI 框架**: PyQt6 6.6.1
- **Web 引擎**: PyQt6-WebEngine 6.6.0
- **数据库**: SQLite (通过 Peewee ORM)
- **Python**: 3.10+

### 项目结构

```
auto-form-filler-py/
├── main.py                    # 程序入口
├── config.py                  # 配置文件
├── requirements.txt           # 依赖包
├── README.md                  # 本文件
│
├── database/                  # 数据库模块
│   ├── __init__.py
│   ├── models.py             # 数据模型
│   └── db_manager.py         # 数据管理
│
├── core/                      # 核心功能
│   ├── __init__.py
│   ├── auto_fill.py          # 通用自动填写引擎
│   ├── auto_fill_v2.py       # 麦客CRM填写引擎
│   ├── tencent_docs_filler.py # 腾讯文档填写引擎 🆕
│   ├── diagnostic.py         # 页面诊断工具
│   └── matcher.py            # 字段匹配算法
│
├── gui/                       # GUI 界面
│   ├── __init__.py
│   ├── main_window.py        # 主窗口
│   ├── card_manager.py       # 名片管理
│   ├── link_manager.py       # 链接管理
│   └── auto_fill_window.py   # 自动填写窗口
│
└── data/                      # 数据目录（自动创建）
    └── auto_form_filler.db   # SQLite 数据库
```

### 核心原理

#### 1. 字段匹配算法

```python
# 匹配流程
1. 查找表单字段的关联 label
2. 检查 placeholder、name、id 等属性
3. 清理文本（去除标点、空格、转小写）
4. 双向包含匹配
5. 返回匹配结果
```

#### 2. 自动填写流程

```python
1. 用户选择名片和链接
2. 在 WebView 中加载目标网页
3. 页面加载完成后延迟 1 秒
4. 生成 JavaScript 填写脚本
5. 注入脚本到网页执行
6. 收集填写结果
7. 保存填写记录
8. 显示通知
```

#### 3. JavaScript 注入

程序会将以下 JavaScript 代码注入到网页：

- 遍历所有表单字段
- 智能匹配字段名称
- 设置字段值
- 触发表单事件（input、change、blur）
- 返回填写结果

## 🎯 使用技巧

### 提高匹配准确率

1. **字段名要准确**：使用与表单相同或相近的字段名
2. **多试几次**：如果匹配失败，尝试换个关键词
3. **使用简短名称**：如 "微信" 比 "微信号码" 更容易匹配
4. **避免特殊字符**：尽量使用中文或英文

### 批量操作

1. **创建多个名片**：为不同的账号创建不同的名片
2. **分类管理链接**：使用分类功能组织链接
3. **查看填写记录**：了解哪些配置需要优化

## ❓ 常见问题

### Q1: 安装依赖失败？

**A:** 可能是 pip 版本过旧或网络问题

```bash
# 升级 pip
pip install --upgrade pip

# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q2: 程序无法启动？

**A:** 检查 Python 版本

```bash
python --version  # 应该是 3.10 或更高
```

### Q3: 自动填写没有效果？

**A:** 可能的原因：

1. 字段名称匹配不准确 → 调整配置
2. 页面加载未完成 → 增加延迟时间（修改 config.py）
3. 特殊表单控件 → 需要手动填写

### Q4: 如何备份数据？

**A:** 直接复制数据库文件

```bash
cp data/auto_form_filler.db data/backup_$(date +%Y%m%d).db
```

### Q5: 支持哪些平台？

**A:**

- ✅ macOS (Intel/Apple Silicon)
- ✅ Windows 10/11
- ✅ Linux (Ubuntu 20.04+)

### Q6: 如何使用腾讯文档表单填写？

**A:**

1. 添加腾讯文档表单链接（包含 `docs.qq.com/form`）
2. 配置名片字段，**字段名要与表单问题标题完全匹配**
3. 使用 "🔍 诊断页面" 查看表单问题标题
4. 根据诊断结果调整名片配置

详细说明请查看 [TENCENT_DOCS_SUPPORT.md](TENCENT_DOCS_SUPPORT.md)

### Q7: 腾讯文档表单填写失败怎么办？

**A:**

可能的原因：

1. **字段名不匹配** → 使用诊断功能查看准确的问题标题
2. **需要登录** → 部分表单需要登录腾讯账号后才能填写
3. **页面未加载完成** → 增加 `config.py` 中的 `AUTO_FILL_DELAY`

排查步骤：

```bash
1. 点击 "🔍 诊断页面" 按钮
2. 查看控制台输出
3. 对比问题标题和名片字段名
4. 调整名片配置后重试
```

### Q8: 如何使用 JWT 自动登录？

**A:**

系统已集成 JWT Token 认证，首次登录后会自动保存 Token：

```
首次登录:
启动程序 → 输入用户名密码 → 自动绑定设备 → 登录成功

再次登录:
启动程序 → 自动使用Token登录 → 无需输入密码
```

**特点**:

- ✅ Token 有效期 30 天
- ✅ 每个用户最多绑定 2 台设备
- ✅ Token 存储在 `~/.auto-form-filler/.token`
- ✅ 管理员可在后台管理所有设备

详细说明请查看 [JWT\_认证与设备管理文档.md](JWT_认证与设备管理文档.md)

### Q9: 设备数量限制怎么办？

**A:**

当提示"该账号已达到最大设备数量限制（2 台）"时：

1. 使用管理员账号登录管理后台
2. 点击左侧菜单 "📱 设备管理"
3. 找到要解绑的设备，点击"解绑"
4. 在新设备上重新登录

## 📚 相关文档

- 📖 [JWT\_认证与设备管理文档.md](JWT_认证与设备管理文档.md) - JWT 认证完整文档
- 🚀 [JWT\_认证快速使用指南.md](JWT_认证快速使用指南.md) - 快速使用指南
- 📘 [TENCENT_DOCS_SUPPORT.md](TENCENT_DOCS_SUPPORT.md) - 腾讯文档表单支持
- 📗 [QUICK_START_TENCENT.md](QUICK_START_TENCENT.md) - 腾讯文档快速开始
- 📙 [用户管理系统说明.md](用户管理系统说明.md) - 用户管理系统

## 🛠️ 开发指南

### 调试模式

在 `config.py` 中设置：

```python
DEBUG = True
```

### 添加新字段类型

1. 修改 `core/auto_fill.py` 中的 `generate_fill_script` 方法
2. 添加新的字段类型判断和填写逻辑

### 自定义样式

修改 `gui/main_window.py` 中的 `setStyleSheet` 方法

## 📝 待办事项

- [ ] 支持单选框和复选框
- [ ] 支持日期选择器
- [ ] 支持文件上传
- [ ] 添加批量填写功能
- [ ] 支持填写规则模板
- [ ] 导出/导入配置
- [ ] 多语言支持
- [ ] 打包成可执行文件

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 📮 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请给个 Star！**

Made with ❤️ by AI Assistant

</div>
