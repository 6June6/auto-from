# 新填充页面说明

## 功能概述

新的填充页面完全符合设计图2的布局，提供了更直观和高效的多名片、多链接填充体验。

## 页面布局

### 1. 顶部标签页
- 每个选中的链接都有一个独立的标签页
- 点击标签页可以切换不同的链接
- 标签页名称显示链接名称

### 2. 左侧/中间区域（WebView网格）
- **链接标题**：显示当前链接的名称
- **名片WebView网格**：横向滚动显示所有选中名片的WebView
- 每个名片都有：
  - 名片名称标题
  - 独立的WebView窗口（初始显示"等待加载表单..."）
  - 独立的Session（Cookie、Token等完全隔离）

### 3. 右侧面板
- **折叠按钮**：点击可以折叠/展开右侧面板
- **类别选择下拉框**：选择名片分类
- **名片列表**：显示当前分类下的所有名片
- **当前名片信息卡片**：
  - 显示选中名片的所有字段
  - 每个字段都有"复制"按钮
  - "修改字段"按钮可以编辑名片

### 4. 底部按钮
- **开始填充**：加载并填充当前标签页的所有表单
- **关闭**：关闭填充窗口

## 使用流程

1. **在主窗口选择名片和链接**
   - 在左侧边栏选择要填充的名片（可多选）
   - 在链接列表中选择要填充的链接（可多选）
   - 点击"开始填充"按钮

2. **新窗口打开**
   - 自动为每个链接创建标签页
   - 每个标签页内显示所有选中名片的WebView
   - 初始状态下WebView不加载（显示提示文字）

3. **选择和查看名片信息**
   - 在右侧选择类别
   - 点击名片列表中的名片
   - 查看名片字段信息
   - 使用"复制"按钮复制字段值

4. **开始填充**
   - 点击底部的"开始填充"按钮
   - 系统会加载当前标签页的所有WebView
   - 等待页面加载完成后自动填充
   - 填充完成后显示结果

## 技术特性

### 1. 独立Session
- 每个WebView都有独立的Profile
- Cookie、Token、缓存完全隔离
- 可以同时登录多个账号

### 2. 智能填充
- 自动检测表单类型（腾讯文档/麦客CRM）
- 根据字段名自动匹配填充
- 支持模糊匹配（使用顿号分隔的别名）

### 3. 批量操作
- 一次可以填充多个名片
- 一次可以处理多个链接
- 通过标签页切换不同链接

## 与旧版对比

### 旧版 (MultiCardFillWindow)
- 所有名片在同一个页面
- 没有标签页分离
- 没有右侧面板
- 无法查看/修改名片信息

### 新版 (NewFillWindow)
- ✅ 标签页分离，每个链接独立
- ✅ 横向滚动的WebView网格
- ✅ 右侧面板显示名片信息
- ✅ 字段复制功能
- ✅ 修改字段功能
- ✅ 折叠/展开右侧面板
- ✅ 类别和名片快速切换

## 调用方式

在主窗口中，"开始填充"按钮已经更新为使用新窗口：

```python
def start_auto_fill(self):
    """开始自动填充"""
    selected_cards = self.get_selected_cards()
    selected_links = self.get_selected_links()
    
    if not selected_cards:
        QMessageBox.warning(self, "提示", "请选择至少一个名片")
        return
    
    if not selected_links:
        QMessageBox.warning(self, "提示", "请选择至少一个链接")
        return
    
    # 打开新的填充窗口（符合设计图）
    fill_window = NewFillWindow(
        selected_cards=selected_cards,
        selected_links=selected_links,
        parent=self,
        current_user=self.current_user
    )
    fill_window.show()
```

## 注意事项

1. **初始不加载**：WebView初始不会加载链接，需要点击"开始填充"按钮
2. **独立Session**：每个WebView都是独立的，互不影响
3. **标签页切换**：点击不同标签页会切换到不同的链接
4. **复制功能**：点击字段右侧的"复制"按钮可以快速复制字段值
5. **修改字段**：点击"修改字段"按钮可以编辑当前名片的信息

## 未来改进

- [ ] 支持拖拽调整WebView大小
- [ ] 支持WebView网格的自定义布局
- [ ] 支持批量复制所有字段
- [ ] 支持填充进度条显示
- [ ] 支持填充日志查看




